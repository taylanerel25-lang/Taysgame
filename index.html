<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Angry Birds — Web Remix</title>
  <meta name="description" content="Slingshot birds at destructible pig forts. Cinematic zooms, level stars, multiple bird types. Single-file build." />
  <style>
    :root{
      --ui:#101423cc; --ui-border:#2a2f4a66; --ink:#0b0e1a; --accent:#ffd24a;
    }
    html,body{height:100%;margin:0;background:#8ed6ff;color:#fff;font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;}
    *{box-sizing:border-box}
    #app{min-height:100%;display:grid;place-items:center;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
    canvas{touch-action:none; background:transparent; display:block; width:min(100vw, 1000px); height:auto; border-radius:16px; box-shadow:0 10px 40px #0005; border:1px solid #0002}
    #hud{position:fixed; inset:auto 0 0 0; display:flex; justify-content:center; gap:8px; padding:10px; pointer-events:none}
    .chip{pointer-events:auto; background:var(--ui); border:1px solid var(--ui-border); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); padding:8px 12px; border-radius:999px; font-size:14px; color:#e6e8f0}
    #score{position:fixed; top:10px; left:12px; background:var(--ui); border:1px solid var(--ui-border); padding:6px 10px; border-radius:10px; font-weight:800}
    #levelName{position:fixed; top:10px; right:12px; background:var(--ui); border:1px solid var(--ui-border); padding:6px 10px; border-radius:10px}
    #overlay{position:fixed; inset:0; display:none; place-items:center; background:#0008}
    #overlay.show{display:grid}
    #panel{background:#1b2035; color:#fff; border:1px solid #2a2f4a; border-radius:16px; padding:16px; width:min(380px, 92vw); box-shadow:0 10px 30px #0007}
    #panel h2{margin:0 0 12px 0}
    #panel .row{display:flex; justify-content:space-between; margin:6px 0}
    #panel button{width:100%; margin-top:12px; padding:10px 14px; border-radius:12px; border:1px solid #2a2f4a; background:#2a3050; color:#fff; cursor:pointer}
    #panel button:hover{filter:brightness(1.08)}
    #paused{position:fixed; inset:0; display:none; place-items:center; background:#0006; color:#fff; font-weight:700; font-size:28px; text-align:center}
    #paused.show{display:grid}
    #bigPopup{position:fixed; top:40%; left:0; right:0; text-align:center; font-weight:900; font-size:64px; opacity:0; transform:translateY(10px); text-shadow:0 4px 0 #0007}
    #a11y{position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden}
  </style>
</head>
<body>
  <div id="app">
    <canvas id="game" width="800" height="450" aria-label="Angry Birds canvas" role="img"></canvas>
  </div>

  <div id="score">Score 0</div>
  <div id="levelName">Level 1-1</div>
  <div id="bigPopup" aria-hidden="true">+5000</div>

  <div id="hud" aria-hidden="false">
    <label class="chip"><input type="checkbox" id="contrastToggle"> High contrast</label>
    <label class="chip"><input type="checkbox" id="muteToggle"> Mute</label>
    <span class="chip">Drag to aim • Release to fire • Space = ability • R = retry • P = pause</span>
  </div>

  <div id="paused" aria-hidden="true"><div>Paused — press <b>P</b> to resume</div></div>

  <div id="overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div id="panel">
      <h2 id="panelTitle">Level Cleared!</h2>
      <div class="row"><span>Score</span><b id="panelScore">0</b></div>
      <div class="row"><span>Best</span><b id="panelBest">0</b></div>
      <div class="row"><span>Stars</span><b id="panelStars">★☆☆</b></div>
      <button id="retryBtn">Retry</button>
      <button id="nextBtn" style="margin-top:8px">Next Level</button>
    </div>
  </div>

  <div id="a11y" aria-live="polite" aria-atomic="true"></div>

  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script>
  const DPR = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
  const logicalW = 800, logicalH = 450;
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  function resize(){
    const vw = Math.min(window.innerWidth, 1100), vh = window.innerHeight;
    const scale = Math.min(vw/logicalW, vh/logicalH);
    canvas.style.width = Math.floor(logicalW*scale)+"px";
    canvas.style.height = Math.floor(logicalH*scale)+"px";
    canvas.width = Math.floor(logicalW*DPR); canvas.height = Math.floor(logicalH*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  addEventListener('resize', resize); resize();

  const {Engine, World, Bodies, Body, Composite, Events, Vector} = Matter;
  const engine = Engine.create({enableSleeping:true});
  const world = engine.world;
  world.gravity.y = 1.2;

  const STATE = {birds:[], pigs:[], blocks:[], currentBird:null, launched:false, paused:false, score:0};

  const MATERIAL = {wood:{density:0.0012, friction:0.6, restitution:0.15, color:'#c58b55'}};
  function makeBlock(x,y,w,h){ const m=MATERIAL.wood; const b=Bodies.rectangle(x,y,w,h,{density:m.density, friction:m.friction, restitution:m.restitution}); World.add(world,b); return b;}
  function makePig(x,y){const b=Bodies.circle(x,y,20,{density:0.0012, friction:0.5});b.plugin={pig:true,hp:80};World.add(world,b);STATE.pigs.push(b);return b;}
  function createBird(x,y){const b=Bodies.circle(x,y,16,{density:0.001, friction:0.5, restitution:0.2});World.add(world,b);return b;}

  const sling={anchor:{x:220,y:340},maxPull:100,pulling:false,pullPos:{x:0,y:0}};
  function addGround(){const g=Bodies.rectangle(400,430,1600,40,{isStatic:true});World.add(world,g);}
  addGround();

  function loadLevel(){
    Composite.clear(world,false); STATE.birds.length=0; STATE.pigs.length=0; STATE.blocks.length=0; STATE.score=0;
    addGround();
    makeBlock(900,380,120,20); makeBlock(900,340,20,80);
    makePig(940,360); STATE.birds.push(createBird(180,380),createBird(140,380),createBird(100,380));
    nextBirdToSling();
  }
  function nextBirdToSling(){
    STATE.currentBird=STATE.birds.shift()||null;
    if(STATE.currentBird){Body.setStatic(STATE.currentBird,true); Body.setPosition(STATE.currentBird,sling.anchor);}
  }

  function launchCurrentBird(){
    if(!STATE.currentBird)return;
    const b=STATE.currentBird; Body.setStatic(b,false);
    const pull=Vector.sub(sling.anchor,sling.pullPos);
    Body.applyForce(b,b.position,Vector.mult(pull,0.0028)); // FIXED: proper force
    STATE.launched=true;
  }

  let mouse={x:0,y:0,down:false};
  function toWorld(pt){
    const rect=canvas.getBoundingClientRect();
    const x=(pt.clientX-rect.left)/(rect.width)*logicalW;
    const y=(pt.clientY-rect.top)/(rect.height)*logicalH;
    return{x,y};
  }

  canvas.addEventListener('mousedown',e=>{mouse.down=true;const p=toWorld(e);const bpos=STATE.currentBird?.position;if(bpos){const d=Vector.magnitude(Vector.sub(p,bpos));if(d<80)sling.pulling=true;}});
  canvas.addEventListener('mouseup',e=>{mouse.down=false;if(sling.pulling){sling.pulling=false;launchCurrentBird();}});
  canvas.addEventListener('mousemove',e=>{
    const p=toWorld(e);
    if(sling.pulling&&STATE.currentBird&&!STATE.launched){
      const vec=Vector.sub(p,sling.anchor);
      const len=Math.min(sling.maxPull,Vector.magnitude(vec));
      const dir=Vector.normalise(vec);
      sling.pullPos={x:sling.anchor.x+dir.x*len,y:sling.anchor.y+dir.y*len};
      Body.setPosition(STATE.currentBird,sling.pullPos);
    }
  });

  Events.on(engine,'collisionStart',ev=>{
    for(const pair of ev.pairs){
      const a=pair.bodyA,b=pair.bodyB;
      const relVel=Vector.magnitude(Vector.sub(a.velocity,b.velocity));
      if(a.plugin&&a.plugin.pig&&relVel>3){World.remove(world,a);STATE.score+=5000;}
      if(b.plugin&&b.plugin.pig&&relVel>3){World.remove(world,b);STATE.score+=5000;}
    }
  });

  function drawWorld(){
    ctx.clearRect(0,0,logicalW,logicalH);
    ctx.fillStyle='#8ed6ff';ctx.fillRect(0,0,logicalW,logicalH);
    for(const b of world.bodies){
      ctx.save();ctx.translate(b.position.x,b.position.y);ctx.rotate(b.angle);
      if(b.circleRadius){
        const isPig=b.plugin&&b.plugin.pig;
        ctx.fillStyle=isPig?'#7bd36a':'#ff4444';
        ctx.beginPath();ctx.arc(0,0,b.circleRadius,0,Math.PI*2);ctx.fill();
      }else{
        const w=b.bounds.max.x-b.bounds.min.x;const h=b.bounds.max.y-b.bounds.min.y;
        ctx.fillStyle='#c58b55';ctx.fillRect(-w/2,-h/2,w,h);
      }
      ctx.restore();
    }
    // sling posts
    const A=sling.anchor;
    ctx.fillStyle='#5c3a1e';ctx.fillRect(A.x-12,A.y-90,8,90);ctx.fillRect(A.x+6,A.y-90,8,90);
    if(STATE.currentBird&&(sling.pulling||!STATE.launched)){
      const bp=STATE.currentBird.position;
      ctx.strokeStyle='#4d2a12';ctx.lineWidth=6;ctx.beginPath();ctx.moveTo(A.x-10,A.y-60);ctx.lineTo(bp.x,bp.y);ctx.stroke();
      ctx.strokeStyle='#7b4420';ctx.beginPath();ctx.moveTo(A.x+10,A.y-54);ctx.lineTo(bp.x,bp.y);ctx.stroke();
    }
  }

  let last=performance.now();
  function loop(){
    const n=performance.now();let dt=(n-last)/1000;last=n;dt=Math.min(dt,1/30);
    if(!STATE.paused){Engine.update(engine,dt*1000);}
    drawWorld();
    requestAnimationFrame(loop);
  }

  loadLevel();
  loop();
  </script>
</body>
</html>
